/** * Allows for the creation of a form. * Adds fields and sections to the form. */var breaks = 0;var col1_up = 0;var col2_up = 0;var active_edit = '';var existing_fields = '';var existing_fieldsets = '';var form_name = 'form';function get_fields() {    show_loading();    send_data = 'action=get_list';    $.post('cp-functions/field_editor.php', send_data, function (repSo) {        existing_fields = repSo;        send_data = 'action=get_fieldset';        $.post('cp-functions/field_editor.php', send_data, function (repSoA) {            existing_fieldsets = repSoA;        });        close_loading();    });    return false;}function prep_add(col, standard) {    if (!col) {        col = '1';    }    if (!standard) {        standard = '0';    }    var adding = '<div id="add_field" style="border:1px solid #ccc;background-color:#fff;font-size:0.8em;width:600px;position: absolute;z-index:99999;left:50%;top:20%;margin-left:-300px;padding:24px;">';    adding += '<div class="col50">';    adding += '<h2>Add a Fieldset</h2><div class="field"><select name="existing_fs" id="existing_fs" style="width:250px;" onchange="return add_fieldset(\'' + col + '\',this.value);"><option value=""></option>';    adding += existing_fieldsets;    adding += '</select></div>';    adding += '<h3 style="margin-top:12px;">Add a Field</h3>';    adding += '<div class="field"><select name="existing" id="existing" style="width:200px;" onchange="return add_field(\'' + col + '\',this.value);"><option value=""></option>';    adding += existing_fields;    adding += '</select></div>';    adding += '</div><div class="col50">';    adding += '<h2 style="margin-top:12px;">Create Section Divider</h2><div class="field"><input type="text" id="new_fieldset" value="" style="width:200px;" /> <input type="button" value="Add" onclick="return add_field(\'' + col + '\',\'section||\');" /></div>';    if (standard == '1') {        adding += '<h1>Add Page Break</h1>';        adding += '<div class="field"><input type="text" id="new_page_break" value="" placeholder="Page/Step Name" style="width:200px;" /> <input type="button" value="Add" onclick="return add_field(\'' + col + '\',\'page_break||\');" /></div>';    } else {        adding += '<h1>New Fields?</h1>';        adding += '<div class="field"><a href="null.php" onclick="return popup(\'field-add\',\'\',\'1\');">Click here to create a new fields.</a></div>';    }    adding += '</div><div class="clear"></div><center><a href="null.php" onclick="return close_add_fields();">Close Window</a></center></div>';    $('body').append(adding);    return false;}function close_add_fields() {    $('#add_field').remove();    return false;}function delete_field(id) {    $('#li-' + id).remove();    return false;}function build_form(id, col) {    show_loading();    send_data = 'action=build_form&id=' + id;    $.post('cp-functions/field_editor.php', send_data, function (repSo) {        if (debug == 1) {            console.log(repSo);        }        var fields_in_set = repSo.toString().split(',');        for (var i = 0; i < fields_in_set.length; i++) {            add_field(col, fields_in_set[i]);        }        close_loading();    });    return false;}function add_fieldset(col, set_data) {    if (set_data) {        show_loading();        var dets = set_data.split('||');        var set_id = dets['0'];        var set_name = dets['1'];        send_data = 'action=fieldset_fields&id=' + set_id;        $.post('cp-functions/field_editor.php', send_data, function (repSo) {            var fields_in_set = repSo.toString().split(',');            for (var i = 0; i < fields_in_set.length; i++) {                add_field(col, fields_in_set[i]);            }            close_loading();        });    }    return false;}function add_field(col, field_data) {    if (field_data) {        var dets = field_data.split('||');        var field_name = dets['1'];        var real_field_id = dets['0'];        var field_req = dets['2'];        var field_type = dets['3'];        if (col == 1) {            var list = 'col1_fields';            var oplist = 'col2_fields';            var using_col = 'col1';            col1_up += 1;            var use_up = col2_up;            var field_id = 'col1-' + col1_up;        } else {            var list = 'col2_fields';            var oplist = 'col1_fields';            var using_col = 'col2';            col2_up += 1;            var use_up = col2_up;            var field_id = 'col2-' + col2_up;        }        var type_img = '';        if (field_type) {            type_img = '<span><img src="imgs/icon-fb-' + field_type + '.png" width="16" height="16" border="0" alt="' + field_type + '" title="' + field_type + '" class="iconmid" /></span>';            type_img = '<span><img src="imgs/icon-fb-' + field_type + '.png" width="16" height="16" border="0" alt="' + field_type + '" title="' + field_type + '" class="iconmid" /></span>';        }        var innerwidth = $('#' + oplist).innerWidth();        if (real_field_id == 'section') {            if (!field_name) {                field_name = $('#new_fieldset').val();            }            //if (! field_name) {            //	field_name = $('#new_fieldset').val();            //	$('#new_fieldset').val('');            //	var addfs = '<input type="hidden" name="' + form_name + '[' + using_col + '][' + field_name + ']" value="section_newzen" />';            //} else {            var addfs = '<input type="hidden" name="' + form_name + '[' + using_col + '][' + field_name + ']" value="section" />';            //}            $('#' + list).append('<li class="section" id="li-' + field_id + '"><div style="float:right;"><img src="imgs/icon-delete.png" width="16" height="16" border="0" onclick="return delete_field(\'' + field_id + '\');" alt="Delete" title="Delete" class="hover" /></div><div class="move"></div>' + type_img + '<b>' + field_name + addfs + '</b></li>');            $('#new_fieldset').val('');        }        else if (real_field_id == 'page_break') {            breaks++;            if (!field_name) {                new_page_break = $('#new_page_break').val();            } else {                new_page_break = field_name;            }            $('#new_page_break').val('');            var addfs = '<input type="hidden" name="' + form_name + '[' + using_col + '][' + new_page_break + ']" value="page_break" />';            $('#' + list).append('<li class="page_break" id="li-' + field_id + '"><div style="float:right;"><img src="imgs/icon-delete.png" width="16" height="16" border="0" onclick="return delete_field(\'' + field_id + '\');" alt="Delete" title="Delete" class="hover" /></div><div class="move"></div>' + type_img + '<b>' + new_page_break + '</b>' + addfs + '</li>');        }        else {            if (real_field_id == 'first_name' || real_field_id == 'last_name' || real_field_id == 'username' || real_field_id == 'password' || real_field_id == 'email') {                req_value = '1';                req_icon = 'icon-required-on.png';            } else {                req_value = '0';                req_icon = 'icon-required.png';            }            $('#' + list).append('<li id="li-' + field_id + '"><div style="float:right;"><img src="imgs/' + req_icon + '" id="reqimg-' + field_id + '" width="16" height="16" border="0" onclick="return set_required(\'' + field_id + '\');" class="icon hover_req" alt="Required" title="Required" /><img src="imgs/icon-delete.png" width="16" height="16" border="0" onclick="return delete_field(\'' + field_id + '\');" class="icon hover" alt="Delete" title="Delete" /></div><div class="move"></div>' + type_img + field_name + '<input type="hidden" id="req-' + field_id + '" name="' + form_name + '[' + using_col + '][' + real_field_id + ']" value="' + req_value + '" /></li>');            if (field_req == '1') {                set_required(field_id, '2');            }        }        $('#' + list + ' li.removefield').remove();    }    return false;}function set_required(id, force) {    if (!force) {        var cur_val = $('#req-' + id).val();    } else {        var cur_val = force;    }    // Set to not required    if (cur_val == '1') {        $('#req-' + id).val('0');        $('#reqimg-' + id).attr('src', 'imgs/icon-required.png');    } else {        $('#req-' + id).val('1');        $('#reqimg-' + id).attr('src', 'imgs/icon-required-on.png');    }    return false;}function update_name(id, value) {    var name = 'name-' + id;    $('#' + name).html(value);    return false;}function edit_field(id) {    exit_editor();    if (id != active_edit) {        active_edit = id;        var check = 'field-edit-' + id;        var checkli = 'li-' + id;        $('#' + check).show();        $('#' + checkli).addClass('on');    } else {        active_edit = '';    }    return false;}function exit_editor() {    $('.field_edit_menu').hide();    $('ul#col1_fields li').removeClass('on');    $('ul#col2_fields li').removeClass('on');    return false;}$("#col1_fields, #col2_fields").sortable({    connectWith: ".colfields",    placeholder: "ui-state-highlight"}).disableSelection();get_fields();