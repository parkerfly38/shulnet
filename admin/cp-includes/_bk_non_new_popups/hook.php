<?php/** * * * Zenbership Membership Software * Copyright (C) 2013-2016 Castlamp, LLC * * This program is free software: you can redistribute it and/or modify * it under the terms of the GNU General Public License as published by * the Free Software Foundation, either version 3 of the License, or * (at your option) any later version. * * This program is distributed in the hope that it will be useful, * but WITHOUT ANY WARRANTY; without even the implied warranty of * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the * GNU General Public License for more details. * * You should have received a copy of the GNU General Public License * along with this program.  If not, see <http://www.gnu.org/licenses/>. * * @author      Castlamp * @link        http://www.castlamp.com/ * @link        http://www.zenbership.com/ * @copyright   (c) 2013-2016 Castlamp * @license     http://www.gnu.org/licenses/gpl-3.0.en.html * @project     Zenbership Membership Software */if (! empty($_POST['id'])) {    $widget = $db->get_hook($_POST['id']);    $type = $widget['type'];        $cid = $_POST['id'];    $editing = '1';        if ($type == '1') {        $path = $widget['data'];    } else {        $data = unserialize($widget['data']);    }    $name = $widget['name'];    $active = $widget['active'];    $when = $widget['when'];    $trigger = $widget['trigger'];    $specific_trigger = $widget['specific_trigger'];    $trigger_type = $widget['trigger_type'];    if ($trigger_type == '1') {        $specific_trigger_product = $specific_trigger;        $specific_trigger_form = '';        $cart = new cart;        $specific_trigger_product_name = $cart->get_product_name($specific_trigger);        $specific_trigger_form_name = '';    }    else if ($trigger_type == '2') {        $specific_trigger_product = '';        $specific_trigger_form = $specific_trigger;        $form = new form;        $specific_trigger_form_name = $form->get_form_name($specific_trigger);        $specific_trigger_product_name = '';    }        if ($type == '2') {        $save = $data['save'];        $trackback = $data['trackback'];        $track_links = $data['track_links'];        $format = $data['format'];        $subject = $data['subject'];        $message = $data['message'];        $to = $data['to'];        $from = $data['from'];        $cc = $data['cc'];        $bcc = $data['bcc'];    }     else if ($type == '3') {        $mysql_host = decode($data['db_host']);        $mysql_db = decode($data['db_name']);        $mysql_username = decode($data['db_user']);        $mysql_password = '';        $mysql_commands = $data['commands'];    }    else if ($type == '5') {        $curl_url = $data['url'];        $curl_qs = $data['query_string'];        $curl_xml = $data['xml'];        $curl_headers = $data['headers'];        $curl_credentials = $data['credentials'];    }    else {        $curl_url = '';        $curl_qs = '';        $curl_xml = '';        $curl_headers = '';        $curl_credentials = '';        $mysql_commands = '';        $mysql_host = '';        $mysql_db = '';        $mysql_username = '';        $mysql_password = '';        $save = '';        $trackback = '';        $track_links = '';        $format = '';        $subject = '';        $message = '';        $to = '';        $from = '';        $cc = '';        $bcc = '';    }    } else {    $cid = 'new';    $editing = '0';    $path = PP_PATH . '/custom';    $name = '';    $type = $_POST['type'];    $save = '1';    $trackback = '1';    $track_links = '0';    $format = '1';    $subject = '';    $message = '';    $to = '';    $from = '';    $cc = '';    $bcc = '';        $active = '1';    $when = '2';    $trigger = '';    $specific_trigger = '0';    $specific_trigger_product_name = '';    $specific_trigger_form_name = '';    $specific_trigger_form = '';    $specific_trigger_product = '';    $trigger_type = '0';}?><script type="text/javascript">    $.ctrl('S', function () {        return json_add('hook-add', '<?php echo $cid; ?>', '<?php echo $editing; ?>', 'popupform');    });</script><form action="" method="post" id="popupform"      onsubmit="return json_add('hook-add','<?php echo $cid; ?>','<?php echo $editing; ?>','popupform');">    <div id="popupsave">        <input type="submit" value="Save" class="save" />        <input type="hidden" name="type" value="<?php echo $type; ?>" />    </div>    <h1>Hook: PHP Code Execution</h1>    <div class="pad24t popupbody">        <fieldset>            <legend>Overview</legend>            <div class="pad24t">                <div class="col50l">                                    <div class="field">                        <label>Status?</label>                        <div class="field_entry">                            <input type="radio" name="active" value="1" <?php if ($active == '1') { echo " checked=\"checked\""; } ?> /> Active<br />                            <input type="radio" name="active" value="0" <?php if ($active != '1') { echo " checked=\"checked\""; } ?> /> Inactive<br />                        </div>                    </div>                                        <div class="field">                        <label>Hook Name</label>                        <div class="field_entry">                            <input type="text" name="name" class="req" id="name" style="width:300px;"                                   value="<?php echo $name; ?>"/>                        </div>                    </div>                    <div class="field">                        <label>When?</label>                        <div class="field_entry">                            <input type="radio" name="when" value="1" <?php if ($when == '1') { echo " checked=\"checked\""; } ?> /> Before Task<br />                            <input type="radio" name="when" value="2" <?php if ($when != '1') { echo " checked=\"checked\""; } ?> /> After Task (most common)<br />                        </div>                    </div>                </div>                <div class="col50r">                    <div class="field">                        <label>Task Trigger</label>                        <div class="field_entry">                            <select name="trigger" class="req" id="trigger" style="Width:300px;">                            <option value=""></option>                            <?php                            echo $db->hook_list($trigger);                            ?>                            </select>                        </div>                    </div>                    <div class="field">                        <label>Specific Trigger?</label>                        <div class="field_entry">                            <input type="radio" name="trigger_type" value="0" <?php if ($trigger_type == '0') { echo " checked=\"checked\""; } ?> onclick="return swap_multi_div('','specific_prod,specific_form');" /> Apply to all tasks<br />                            <input type="radio" name="trigger_type" value="1" <?php if ($trigger_type == '1') { echo " checked=\"checked\""; } ?> onclick="return swap_multi_div('specific_prod','specific_form');" /> Apply to specific product<br />                            <input type="radio" name="trigger_type" value="2" <?php if ($trigger_type == '2') { echo " checked=\"checked\""; } ?> onclick="return swap_multi_div('specific_form','specific_prod');" /> Apply to specific form<br />                        </div>                    </div>                    <div class="field" id="specific_prod" style="display:<?php if ($trigger_type == '1') { echo "block"; } else { echo "none"; } ?>;">                        <label>Specific Products</label>                        <div class="field_entry">                            <input type="text" value="<?php echo $specific_trigger_product_name; ?>" name="specific_prod_dud" id="productd"                                   autocomplete="off" onkeyup="return autocom(this.id,'id','name','ppSD_products','name','products');"                                   style="width:90%;"/> <a href="null.php" onclick="return get_list('products','productd_id','productd');"><img src="imgs/icon-list.png" width="16" height="16" border="0" alt="Select from list" title="Select from list" class="icon-right"/></a>                            <input type="hidden" name="specific_prod" id="productd_id" value="<?php echo $specific_trigger_product; ?>"/>                        </div>                    </div>                    <div class="field" id="specific_form" style="display:<?php if ($trigger_type == '2') { echo "block"; } else { echo "none"; } ?>;">                        <label>Specific Form</label>                        <div class="field_entry">                            <input type="text" value="<?php echo $specific_trigger_form_name; ?>" name="specific_form_dud" id="formd"                                   autocomplete="off" onkeyup="return autocom(this.id,'id','name','ppSD_forms','name','products');"                                   style="width:90%;"/> <a href="null.php" onclick="return get_list('forms','formd_id','formd');"><img src="imgs/icon-list.png" width="16" height="16" border="0" alt="Select from list" title="Select from list" class="icon-right"/></a>                            <input type="hidden" name="specific_form" id="formd_id" value="<?php echo $specific_trigger_form; ?>"/>                        </div>                    </div>                </div>                <div class="clear"></div>            </div>        </fieldset>        <?php        if ($type == '1') {        ?>        <fieldset>            <legend>PHP Hook</legend>            <div class="pad24t">                <div class="field">                    <label>Path to File</label>                    <div class="field_entry">                        <input type="text" name="path" class="req" id="path"                               style="width:100%;" value="<?php echo $path; ?>"/>                    </div>                </div>            </div>        </fieldset>        <?php        }        else if ($type == '2') {        ?>        <fieldset>            <legend>E-Mail Hook</legend>            <div class="pad24t">                <div class="col50l">                    <div class="field">                        <label>To</label>                        <div class="field_entry">                            <input type="text" name="data[to]" style="width:90%" value="<?php echo $to; ?>" />                        </div>                    </div>                                        <div class="field">                        <label>From</label>                        <div class="field_entry">                            <input type="text" name="data[from]" style="width:90%" value="<?php echo $from; ?>" />                        </div>                    </div>                                    <div class="field">                        <label>CC</label>                        <div class="field_entry">                            <input type="text" name="data[cc]" style="width:90%" value="<?php echo $cc; ?>" />                        </div>                    </div>                                        <div class="field">                        <label>BCC</label>                        <div class="field_entry">                            <input type="text" name="data[bcc]" style="width:90%" value="<?php echo $bcc; ?>" />                        </div>                    </div>                                </div>                <div class="col50r">                                    <div class="field">                        <label>Save</label>                        <div class="field_entry">                            <input type="radio" name="data[save]" value="1" <?php if ($save == '1') { echo " checked=\"checked\""; } ?> /> Save a copy<br />                            <input type="radio" name="data[save]" value="0" <?php if ($save != '1') { echo " checked=\"checked\""; } ?> /> Do not save a copy                        </div>                    </div>                                    <div class="field">                        <label>Tracking</label>                        <div class="field_entry">                            <input type="radio" name="data[trackback]" value="1" <?php if ($trackback == '1') { echo " checked=\"checked\""; } ?> /> Track when opened<br />                            <input type="radio" name="data[trackback]" value="0" <?php if ($trackback != '1') { echo " checked=\"checked\""; } ?> /> Do not track when opened                        </div>                    </div>                                        <div class="field">                        <label>Link Clicking</label>                        <div class="field_entry">                            <input type="radio" name="data[track_links]" value="1" <?php if ($track_links == '1') { echo " checked=\"checked\""; } ?> /> Track link clicks<br />                            <input type="radio" name="data[track_links]" value="0" <?php if ($track_links != '1') { echo " checked=\"checked\""; } ?> /> Do not track link clicks                        </div>                    </div>                                        <div class="field">                        <label>Format</label>                        <div class="field_entry">                            <input type="radio" name="data[format]" value="1" <?php if ($format == '1') { echo " checked=\"checked\""; } ?> /> HTML<br />                            <input type="radio" name="data[format]" value="0" <?php if ($format != '1') { echo " checked=\"checked\""; } ?> /> Plain Text                        </div>                    </div>                                    </div>                <div class="clear"></div>                                <div class="field">                    <label>Subject</label>                    <div class="field_entry">                        <input type="text" name="data[subject]" style="width:100%" value="<?php echo $subject; ?>" />                    </div>                </div>                                <div class="field">                    <label class="top">Message</label>                    <div class="clear"></div>                    <div class="field_entry_top">                        <textarea name="data[message]" class="richtext" id="message" style="width:100%;height:350px;"><?php echo $message; ?></textarea>                        <?php                        // Not working for some reason...                        echo $admin->richtext('100%', '350px', 'message');                        ?>                    </div>                </div>                            </div>        </fieldset>        <?php        }        else if ($type == '3') {        ?>        <fieldset>            <legend>MySQL Hook</legend>            <div class="pad24t">                                        <div class="col50l">                    <div class="field">                        <label>Server Host</label>                        <div class="field_entry">                            <input type="text" name="data[db_host]" style="width:90%" value="<?php echo $mysql_host; ?>" />                        </div>                    </div>                                        <div class="field">                        <label>Database Name</label>                        <div class="field_entry">                            <input type="text" name="data[db_name]" style="width:90%" value="<?php echo $mysql_db; ?>" />                        </div>                    </div>                                </div>                <div class="col50r">                                    <div class="field">                        <label>Username</label>                        <div class="field_entry">                            <input type="text" name="data[db_user]" style="width:90%" value="<?php echo $mysql_username; ?>" />                        </div>                    </div>                                        <div class="field">                        <label>Password</label>                        <div class="field_entry">                            <input type="text" name="data[db_pass]" style="width:90%" value="<?php echo $mysql_password; ?>" />                        </div>                    </div>                                    </div>                <div class="clear"></div>                                <div class="field">                    <label class="top">Commands</label>                    <div class="clear"></div>                    <div class="field_entry_top">                        <textarea name="data[commands]" class="richtext" id="commands" style="width:100%;height:350px;"><?php echo $mysql_commands; ?></textarea>                    </div>                </div>                            </div>        </fieldset>        <?php        }        else if ($type == '5') {        ?>        <fieldset>            <legend>Outside Connection Hook</legend>            <div class="pad24t">                                <div class="col50l">                                    <div class="field">                        <label>URL</label>                        <div class="field_entry">                            <input type="text" name="data[url]" style="width:100%" value="<?php echo $curl_url; ?>" />                        </div>                    </div>                                        <div class="field">                        <label>Query String</label>                        <div class="field_entry">                        <textarea name="data[query_string]" class="richtext" id="qs123" style="width:100%;height:100px;"><?php echo $curl_qs; ?></textarea>                        </div>                    </div>                                    </div>                <div class="col50r">                                    <div class="field">                        <label>Data Type</label>                        <div class="field_entry">                            <input type="radio" name="data[xml]" value="0" <?php if ($curl_xml != '1') { echo " checked=\"checked\""; } ?> /> Query String<br />                            <input type="radio" name="data[xml]" value="1" <?php if ($curl_xml == '1') { echo " checked=\"checked\""; } ?> /> XML<br />                        </div>                    </div>                                        <div class="field">                        <label>Headers</label>                        <div class="field_entry">                            <input type="text" name="data[headers]" style="width:100%" value="<?php echo $curl_headers; ?>" />                        </div>                    </div>                                        <div class="field">                        <label>Credentials</label>                        <div class="field_entry">                            <input type="text" name="data[credentials]" style="width:100%" value="<?php echo $curl_credentials; ?>" />                        </div>                    </div>                                    </div>                <div class="clear"></div>            </div>        </fieldset>        <?php        }        ?>            </div></form><script type="text/javascript">    function check_folder() {        send_data = 'path=' + $('#path').val();        $.post('cp-functions/check_folder.php', send_data, function (theResponse) {            $('#preview_path').html(theResponse);        });        return false;    }</script>