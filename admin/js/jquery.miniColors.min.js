if(jQuery)(function(e){e.extend(e.fn,{miniColors:function(t,n){var r=function(t,n,r){var i=w(t.val())||"ffffff",s=N(i),f=E(s),l=parseFloat(t.attr("data-opacity")).toFixed(2);if(l>1)l=1;if(l<0)l=0;var c=e('<a class="miniColors-trigger" style="background-color: #'+i+'" href="#"></a>');c.insertAfter(t);c.wrap('<span class="miniColors-triggerWrap"></span>');if(n.opacity){c.css("backgroundColor","rgba("+f.r+", "+f.g+", "+f.b+", "+l+")")}t.addClass("miniColors").data("original-maxlength",t.attr("maxlength")||null).data("original-autocomplete",t.attr("autocomplete")||null).data("letterCase",n.letterCase==="uppercase"?"uppercase":"lowercase").data("opacity",n.opacity?true:false).data("alpha",l).data("trigger",c).data("hsb",s).data("change",n.change?n.change:null).data("close",n.close?n.close:null).data("open",n.open?n.open:null).attr("maxlength",7).attr("autocomplete","off").val("#"+v(i,n.letterCase));if(n.readonly||t.prop("readonly"))t.prop("readonly",true);if(n.disabled||t.prop("disabled"))o(t);c.on("click.miniColors",function(e){e.preventDefault();if(t.val()==="")t.val("#");u(t)});t.on("focus.miniColors",function(e){if(t.val()==="")t.val("#");u(t)});t.on("blur.miniColors",function(e){var n=w(C(t.data("hsb")));t.val(n?"#"+v(n,t.data("letterCase")):"")});t.on("keydown.miniColors",function(e){if(e.keyCode===9)a(t)});t.on("keyup.miniColors",function(e){d(t)});t.on("paste.miniColors",function(e){setTimeout(function(){d(t)},5)})};var i=function(t){a();t=e(t);t.data("trigger").parent().remove();t.attr("autocomplete",t.data("original-autocomplete")).attr("maxlength",t.data("original-maxlength")).removeData().removeClass("miniColors").off(".miniColors");e(document).off(".miniColors")};var s=function(e){e.prop("disabled",false).data("trigger").parent().removeClass("disabled")};var o=function(e){a(e);e.prop("disabled",true).data("trigger").parent().addClass("disabled")};var u=function(t){if(t.prop("disabled"))return false;a();var n=e('<div class="miniColors-selector"></div>');n.append('<div class="miniColors-hues"><div class="miniColors-huePicker"></div></div>').append('<div class="miniColors-colors" style="background-color: #FFF;"><div class="miniColors-colorPicker"><div class="miniColors-colorPicker-inner"></div></div>').css("display","none").addClass(t.attr("class"));if(t.data("opacity")){n.addClass("opacity").prepend('<div class="miniColors-opacity"><div class="miniColors-opacityPicker"></div></div>')}var r=t.data("hsb");n.find(".miniColors-colors").css("backgroundColor","#"+C({h:r.h,s:100,b:100})).end().find(".miniColors-opacity").css("backgroundColor","#"+C({h:r.h,s:r.s,b:r.b})).end();var i=t.data("colorPosition");if(!i)i=m(r);n.find(".miniColors-colorPicker").css("top",i.y+"px").css("left",i.x+"px");var s=t.data("huePosition");if(!s)s=g(r);n.find(".miniColors-huePicker").css("top",s+"px");var o=t.data("opacityPosition");if(!o)o=y(t.attr("data-opacity"));n.find(".miniColors-opacityPicker").css("top",o+"px");t.data("selector",n).data("huePicker",n.find(".miniColors-huePicker")).data("opacityPicker",n.find(".miniColors-opacityPicker")).data("colorPicker",n.find(".miniColors-colorPicker")).data("mousebutton",0);e("BODY").append(n);var u=t.data("trigger"),h=!t.is(":visible"),p=h?u.offset().top+u.outerHeight():t.offset().top+t.outerHeight(),d=h?u.offset().left:t.offset().left,v=n.outerWidth(),b=n.outerHeight(),w=u.outerWidth(),S=u.outerHeight(),x=e(window).height(),T=e(window).width(),N=e(window).scrollTop(),k=e(window).scrollLeft();if(p+b>x+N)p=p-b-S;if(d+v>T+k)d=d-v+w;n.css({top:p,left:d}).fadeIn(100);n.on("selectstart",function(){return false});if(!e.browser.msie||e.browser.msie&&e.browser.version>=9){e(window).on("resize.miniColors",function(e){a(t)})}e(document).on("mousedown.miniColors touchstart.miniColors",function(n){t.data("mousebutton",1);var r=e(n.target).parents().andSelf();if(r.hasClass("miniColors-colors")){n.preventDefault();t.data("moving","colors");f(t,n)}if(r.hasClass("miniColors-hues")){n.preventDefault();t.data("moving","hues");l(t,n)}if(r.hasClass("miniColors-opacity")){n.preventDefault();t.data("moving","opacity");c(t,n)}if(r.hasClass("miniColors-selector")){n.preventDefault();return}if(r.hasClass("miniColors"))return;a(t)}).on("mouseup.miniColors touchend.miniColors",function(e){e.preventDefault();t.data("mousebutton",0).removeData("moving")}).on("mousemove.miniColors touchmove.miniColors",function(e){e.preventDefault();if(t.data("mousebutton")===1){if(t.data("moving")==="colors")f(t,e);if(t.data("moving")==="hues")l(t,e);if(t.data("moving")==="opacity")c(t,e)}});if(t.data("open")){t.data("open").call(t.get(0),"#"+C(r),e.extend(E(r),{a:parseFloat(t.attr("data-opacity"))}))}};var a=function(t){if(!t)t=e(".miniColors");t.each(function(){var n=e(this).data("selector");e(this).removeData("selector");e(n).fadeOut(100,function(){if(t.data("close")){var n=t.data("hsb"),r=C(n);t.data("close").call(t.get(0),"#"+r,e.extend(E(n),{a:parseFloat(t.attr("data-opacity"))}))}e(this).remove()})});e(document).off(".miniColors")};var f=function(e,t){var n=e.data("colorPicker");n.hide();var r={x:t.pageX,y:t.pageY};if(t.originalEvent.changedTouches){r.x=t.originalEvent.changedTouches[0].pageX;r.y=t.originalEvent.changedTouches[0].pageY}r.x=r.x-e.data("selector").find(".miniColors-colors").offset().left-6;r.y=r.y-e.data("selector").find(".miniColors-colors").offset().top-6;if(r.x<=-5)r.x=-5;if(r.x>=144)r.x=144;if(r.y<=-5)r.y=-5;if(r.y>=144)r.y=144;e.data("colorPosition",r);n.css("left",r.x).css("top",r.y).show();var i=Math.round((r.x+5)*.67);if(i<0)i=0;if(i>100)i=100;var s=100-Math.round((r.y+5)*.67);if(s<0)s=0;if(s>100)s=100;var o=e.data("hsb");o.s=i;o.b=s;p(e,o,true)};var l=function(e,t){var n=e.data("huePicker");n.hide();var r=t.pageY;if(t.originalEvent.changedTouches){r=t.originalEvent.changedTouches[0].pageY}r=r-e.data("selector").find(".miniColors-colors").offset().top-1;if(r<=-1)r=-1;if(r>=149)r=149;e.data("huePosition",r);n.css("top",r).show();var i=Math.round((150-r-1)*2.4);if(i<0)i=0;if(i>360)i=360;var s=e.data("hsb");s.h=i;p(e,s,true)};var c=function(e,t){var n=e.data("opacityPicker");n.hide();var r=t.pageY;if(t.originalEvent.changedTouches){r=t.originalEvent.changedTouches[0].pageY}r=r-e.data("selector").find(".miniColors-colors").offset().top-1;if(r<=-1)r=-1;if(r>=149)r=149;e.data("opacityPosition",r);n.css("top",r).show();var i=parseFloat((150-r-1)/150).toFixed(2);if(i<0)i=0;if(i>1)i=1;e.data("alpha",i).attr("data-opacity",i);p(e,e.data("hsb"),true)};var p=function(t,n,r){t.data("hsb",n);var i=C(n),s=e(t.data("selector"));if(r)t.val("#"+v(i,t.data("letterCase")));s.find(".miniColors-colors").css("backgroundColor","#"+C({h:n.h,s:100,b:100})).end().find(".miniColors-opacity").css("backgroundColor","#"+i).end();var o=E(n);t.data("trigger").css("backgroundColor","#"+i);if(t.data("opacity")){t.data("trigger").css("backgroundColor","rgba("+o.r+", "+o.g+", "+o.b+", "+t.attr("data-opacity")+")")}if(t.data("change")){if(i+","+t.attr("data-opacity")===t.data("lastChange"))return;t.data("change").call(t.get(0),"#"+i,e.extend(E(n),{a:parseFloat(t.attr("data-opacity"))}));t.data("lastChange",i+","+t.attr("data-opacity"))}};var d=function(t){t.val("#"+b(t.val()));var n=w(t.val());if(!n)return false;var r=N(n);var i=m(r);var s=e(t.data("colorPicker"));s.css("top",i.y+"px").css("left",i.x+"px");t.data("colorPosition",i);var o=g(r);var u=e(t.data("huePicker"));u.css("top",o+"px");t.data("huePosition",o);var a=y(t.attr("data-opacity"));var f=e(t.data("opacityPicker"));f.css("top",a+"px");t.data("opacityPosition",a);p(t,r);return true};var v=function(e,t){if(t==="uppercase"){return e.toUpperCase()}else{return e.toLowerCase()}};var m=function(e){var t=Math.ceil(e.s/.67);if(t<0)t=0;if(t>150)t=150;var n=150-Math.ceil(e.b/.67);if(n<0)n=0;if(n>150)n=150;return{x:t-5,y:n-5}};var g=function(e){var t=150-e.h/2.4;if(t<0)h=0;if(t>150)h=150;return t};var y=function(e){var t=150*e;if(t<0)t=0;if(t>150)t=150;return 150-t};var b=function(e){return e.replace(/[^A-F0-9]/ig,"")};var w=function(e){e=b(e);if(!e)return null;if(e.length===3)e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2];return e.length===6?e:null};var E=function(e){var t={};var n=Math.round(e.h);var r=Math.round(e.s*255/100);var i=Math.round(e.b*255/100);if(r===0){t.r=t.g=t.b=i}else{var s=i;var o=(255-r)*i/255;var u=(s-o)*(n%60)/60;if(n===360)n=0;if(n<60){t.r=s;t.b=o;t.g=o+u}else if(n<120){t.g=s;t.b=o;t.r=s-u}else if(n<180){t.g=s;t.r=o;t.b=o+u}else if(n<240){t.b=s;t.r=o;t.g=s-u}else if(n<300){t.b=s;t.g=o;t.r=o+u}else if(n<360){t.r=s;t.g=o;t.b=s-u}else{t.r=0;t.g=0;t.b=0}}return{r:Math.round(t.r),g:Math.round(t.g),b:Math.round(t.b)}};var S=function(t){var n=[t.r.toString(16),t.g.toString(16),t.b.toString(16)];e.each(n,function(e,t){if(t.length===1)n[e]="0"+t});return n.join("")};var x=function(e){e=parseInt(e.indexOf("#")>-1?e.substring(1):e,16);return{r:e>>16,g:(e&65280)>>8,b:e&255}};var T=function(e){var t={h:0,s:0,b:0};var n=Math.min(e.r,e.g,e.b);var r=Math.max(e.r,e.g,e.b);var i=r-n;t.b=r;t.s=r!==0?255*i/r:0;if(t.s!==0){if(e.r===r){t.h=(e.g-e.b)/i}else if(e.g===r){t.h=2+(e.b-e.r)/i}else{t.h=4+(e.r-e.g)/i}}else{t.h=-1}t.h*=60;if(t.h<0){t.h+=360}t.s*=100/255;t.b*=100/255;return t};var N=function(e){var t=T(x(e));if(t.s===0)t.h=360;return t};var C=function(e){return S(E(e))};switch(t){case"readonly":e(this).each(function(){if(!e(this).hasClass("miniColors"))return;e(this).prop("readonly",n)});return e(this);case"disabled":e(this).each(function(){if(!e(this).hasClass("miniColors"))return;if(n){o(e(this))}else{s(e(this))}});return e(this);case"value":if(n===undefined){if(!e(this).hasClass("miniColors"))return;var k=e(this),L=w(k.val());return L?"#"+v(L,k.data("letterCase")):null}e(this).each(function(){if(!e(this).hasClass("miniColors"))return;e(this).val(n);d(e(this))});return e(this);case"opacity":if(n===undefined){if(!e(this).hasClass("miniColors"))return;if(e(this).data("opacity")){return parseFloat(e(this).attr("data-opacity"))}else{return null}}e(this).each(function(){if(!e(this).hasClass("miniColors"))return;if(n<0)n=0;if(n>1)n=1;e(this).attr("data-opacity",n).data("alpha",n);d(e(this))});return e(this);case"destroy":e(this).each(function(){if(!e(this).hasClass("miniColors"))return;i(e(this))});return e(this);default:if(!t)t={};e(this).each(function(){if(e(this)[0].tagName.toLowerCase()!=="input")return;if(e(this).data("trigger"))return;r(e(this),t,n)});return e(this)}}})})(jQuery)