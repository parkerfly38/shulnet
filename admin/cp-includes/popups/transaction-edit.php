<?php/** * * * Zenbership Membership Software * Copyright (C) 2013-2016 Castlamp, LLC * * This program is free software: you can redistribute it and/or modify * it under the terms of the GNU General Public License as published by * the Free Software Foundation, either version 3 of the License, or * (at your option) any later version. * * This program is distributed in the hope that it will be useful, * but WITHOUT ANY WARRANTY; without even the implied warranty of * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the * GNU General Public License for more details. * * You should have received a copy of the GNU General Public License * along with this program.  If not, see <http://www.gnu.org/licenses/>. * * @author      Castlamp * @link        http://www.castlamp.com/ * @link        http://www.zenbership.com/ * @copyright   (c) 2013-2016 Castlamp * @license     http://www.gnu.org/licenses/gpl-3.0.en.html * @project     Zenbership Membership Software */if (!empty($_POST['id'])) {    $cart = new cart;    $data = $cart->get_order($_POST['id']);    // $data = new history($_POST['id'],'','','','','','ppSD_cart_terms');    $cid     = $_POST['id'];    $editing = '1';}?><script type="text/javascript">    $.ctrl('S', function () {        return json_add('transaction-add', '<?php echo $cid; ?>', '<?php echo $editing; ?>', 'popupform');    });</script><form action="" method="post" id="popupform"      onsubmit="return json_add('transaction-add','<?php echo $cid; ?>','<?php echo $editing; ?>','popupform');"><div id="popupsave">    <input type="submit" value="Save" class="save"/></div><h1>Edit Order</h1><div class="pad24t popupbody"><fieldset>    <legend>Overview</legend>    <div class="pad24t">        <div class="field">            <label class="">Order No</label>            <div class="field_entry">                <input type="hidden" value="<?php echo $cid; ?>" name="order[id]"/>                <?php echo $cid; ?>            </div>        </div>        <div class="field">            <label class="">Date</label>            <div class="field_entry">                <input type="hidden" name="order[date]" value="<?php echo $data['data']['date']; ?>"/>                <?php echo format_date($data['data']['date']); ?>            </div>        </div>        <div class="field">            <label class="">Promo Code</label>            <div class="field_entry">                <input type="text" name="coupon_dud" id="coupond" value="<?php echo $data['data']['code']; ?>"                       autocomplete="off" onkeyup="return autocom(this.id,'id','id','ppSD_cart_coupon_codes','id','promo_code');"                       style="width:200px;"/>                <input type="hidden" name="order[code]" id="coupond_id" value="<?php echo $data['data']['code']; ?>"/>            </div>        </div>        <div class="field">            <label class="">Member</label>            <div class="field_entry">                <?php                if ($data['data']['member_type'] == 'member' && !empty($data['data']['member_id'])) {                    $user     = new user;                    $udata    = $user->get_user($data['data']['member_id']);                    $username = $udata['data']['username'];                } else {                    $username = '';                }                ?>                <input type="text" value="<?php echo $username; ?>" name="username_dud" id="usernamed"                       autocomplete="off" onkeyup="return autocom(this.id,'id','username','ppSD_members','username','members');"                       style="width:200px;"/>                <input type="hidden" name="order[member_id]" id="usernamed_id"                       value="<?php echo $data['data']['member_id']; ?>"/>            </div>        </div>    </div></fieldset><?phpif (!empty($data['shipping_info'])) {    if (!empty($data['shipping_info']['cart_session']) && $data['shipping_info']['shipped'] != '1') {        $shipping = '1';    } else {        if ($data['shipping_info']['shipped'] != '1') {            $shipping = '0';        } else {            $shipping = '2';        }    }} else {    $shipping = '0';}if ($shipping != '0') {    ?>    <fieldset>    <legend>Shipping Details</legend>    <div class="pad24t">    <?php    if ($shipping == '2') {        ?>        <p>This order shipped on <?php echo format_date($data['shipping_info']['ship_date']); ?>            through <?php echo $data['shipping_info']['shipping_provider'];            if ($data['shipping_info']['trackable'] == '1') {                echo " (tracking number " . $data['shipping_info']['shipping_number'] . ")";            } else {                echo ".";            }            ?></p>    <?php    } else {        ?>        <div class="field">            <label>Shipping?</label>            <div class="field_entry">                <input type="radio" name="ship_yesno" value="0" <?php if ($shipping != '1') {                    echo "checked=\"checked\"";                } ?> onclick="return hide_div('shipping_show');"/> No shipping required                <input type="radio" name="ship_yesno" value="1" <?php if ($shipping == '1') {                    echo "checked=\"checked\"";                } ?> onclick="return show_div('shipping_show');"/> Shipping required            </div>        </div>    <?php    }    ?>    <div id="shipping_show" style="display:<?php if ($shipping == '1') {        echo "block";    } else {        echo "none";    } ?>;margin-top:12px;">        <div class="field">            <label>Company Name</label>            <div class="field_entry">                <input type="text" name="shipping[company_name]" style="width:220px;"                       value="<?php echo $data['shipping_info']['company_name']; ?>" maxlength="255"/>            </div>        </div>        <div class="field">            <label>First Name</label>            <div class="field_entry">                <input type="text" value="<?php echo $data['shipping_info']['first_name']; ?>"                       name="shipping[first_name]" style="width:220px;"/>            </div>        </div>        <div class="field">            <label>Last Name</label>            <div class="field_entry">                <input type="text" value="<?php echo $data['shipping_info']['last_name']; ?>" name="shipping[last_name]"                       style="width:220px;"/>            </div>        </div>        <div class="field">            <label>Address Line 1</label>            <div class="field_entry">                <input type="text" value="<?php echo $data['shipping_info']['address_line_1']; ?>"                       name="shipping[address_line_1]" style="width:220px;"/>            </div>        </div>        <div class="field">            <label>Address Line 2</label>            <div class="field_entry">                <input type="text" value="<?php echo $data['shipping_info']['address_line_2']; ?>"                       name="shipping[address_line_2]" style="width:200px;"/>            </div>        </div>        <div class="field">            <label>City</label>            <div class="field_entry">                <input type="text" name="shipping[city]" style="width:220px;"                       value="<?php echo $data['shipping_info']['city']; ?>"/>            </div>        </div>        <div class="field">            <label>State</label>            <div class="field_entry">                <select name="shipping[state]" style="width:220px;">                    <?php                    $fields = new field;                    echo $fields->state_list($data['shipping_info']['state'], '1', 'select');                    ?>                </select>            </div>        </div>        <div class="field">            <label>Zip</label>            <div class="field_entry">                <input type="text" name="shipping[zip]" style="width:100px;"                       value="<?php echo $data['shipping_info']['zip']; ?>" maxlength="6"/>            </div>        </div>        <div class="field">            <label>Country</label>            <div class="field_entry">                <select name="shipping[country]" style="width:220px;">                    <?php                    $fields = new field;                    echo $fields->country_list($data['shipping_info']['country'], '1', 'select');                    ?>                </select>            </div>        </div>        <div class="field">            <label>Instructions</label>            <div class="field_entry">                <input type="text" name="shipping[ship_directions]" style="width:100%;"                       value="<?php echo $data['shipping_info']['ship_directions']; ?>" maxlength="255"/>            </div>        </div>    </div>    </div>    </fieldset><?php}?><fieldset>    <legend>Taxes</legend>    <div class="pad24">        <?php        if (!empty($data['data']['state']) || !empty($data['data']['country'])) {            $taxable = '1';        } else {            $taxable = '0';        }        ?>        <div class="field">            <label class="less">Exempt?</label>            <div class="field_entry_less">                <input type="radio" name="tax_exempt" value="1" <?php if ($taxable != '1') {                    echo "checked=\"checked\"";                } ?> onclick="return hide_div('show_tax');"/> Tax Exempt                <input type="radio" name="tax_exempt" value="0" <?php if ($taxable == '1') {                    echo "checked=\"checked\"";                } ?> onclick="return show_div('show_tax');"/> Taxable            </div>        </div>        <div id="show_tax" style="display:<?php if ($taxable == '1') {            echo "block";        } else {            echo "none";        } ?>;">            <div class="field">                <label class="less">State</label>                <div class="field_entry_less">                    <select name="order[state]" style="width:220px;">                        <?php                        $fields = new field;                        echo $fields->state_list($data['data']['state'], '1', 'select');                        ?>                    </select>                </div>            </div>            <div class="field">                <label class="less">Country</label>                <div class="field_entry_less">                    <select name="order[country]" style="width:220px;">                        <?php                        $fields = new field;                        echo $fields->country_list($data['data']['country'], '1', 'select');                        ?>                    </select>                </div>            </div>        </div>    </div></fieldset></div></form>