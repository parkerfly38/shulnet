<?php/** * * * Zenbership Membership Software * Copyright (C) 2013-2016 Castlamp, LLC * * This program is free software: you can redistribute it and/or modify * it under the terms of the GNU General Public License as published by * the Free Software Foundation, either version 3 of the License, or * (at your option) any later version. * * This program is distributed in the hope that it will be useful, * but WITHOUT ANY WARRANTY; without even the implied warranty of * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the * GNU General Public License for more details. * * You should have received a copy of the GNU General Public License * along with this program.  If not, see <http://www.gnu.org/licenses/>. * * @author      Castlamp * @link        http://www.castlamp.com/ * @link        http://www.zenbership.com/ * @copyright   (c) 2013-2016 Castlamp * @license     http://www.gnu.org/licenses/gpl-3.0.en.html * @project     Zenbership Membership Software */$editing = '0';$cid = generate_id('random', '22');$title = "Creating Subscription";$datein = explode(' ', current_date());$date = $datein['0'];if (! empty($_POST['user_id'])) {    $user = new user;    $getU = $user->get_user($_POST['user_id']);    $username = $getU['data']['username'];    $user_id = $getU['data']['id'];} else {    $getU = array();    $username = '';    $user_id = '';}$product = '';$product_id = '';$card_id = '';$price = '';?><script type="text/javascript">    $.ctrl('S', function () {        return json_add('subscription-add', '<?php echo $cid; ?>', '0', 'popupform');    });</script><form action="" method="post" id="popupform"      onsubmit="return json_add('subscription-add','<?php echo $cid; ?>','0','popupform');"><div id="popupsave">    <input type="submit" value="Save" class="save"/>    <input type="hidden" name="id" value="<?php echo $cid; ?>"/></div><h1>Creating Subscription</h1><div class="pad24t popupbody"><fieldset>    <legend>Overview</legend>    <div class="pad24">        <div class="field">            <label>Next Renewal</label>            <div class="field_entry">                <?php                echo $admin->datepicker('sub[next_renew]', $date, '0', '250', '', '', '1');                ?>                <p class="field_desc">Setting this to today's date will charge the user the next time the cron job                    runs.</p>            </div>        </div>        <div class="field">            <label>Product</label>            <div class="field_entry">                <input type="text" class="req" value="<?php echo $product; ?>" name="product_dud" id="productd"                       autocomplete="off" onkeyup="return autocom(this.id,'id','name','ppSD_products','name','products');"                       style="width:250px;"/><a href="null.php"                                                onclick="return get_list('subscription_products','productd_id','productd');"><img                        src="imgs/icon-list.png" width="16" height="16" border="0" alt="Select from list"                        title="Select from list" class="icon-right"/></a>                <input type="hidden" name="sub[product]" id="productd_id" value="<?php echo $product_id; ?>"/>            </div>        </div>        <div class="field">            <label>Price</label>            <div class="field_entry">                <?php                echo place_currency('<input type="text" name="sub[price]" value="' . $price . '" maxlength="12" style="width:125px;" />', '1');                ?>                <p class="field_desc">Leave blank to use the standard product price. Setting this to any value will                    automatically override any trial period and pricing associated with the product.</p>            </div>        </div>        <div class="field">            <label>Options</label>            <div class="field_entry">                <input type="radio" name="skip_trial" value="1" checked="checked"/> Skip trial period, if any.<br/>                <input type="radio" name="skip_trial" value="0"/> Do not skip trial period.            </div>        </div>    </div></fieldset><fieldset>    <legend>User Details</legend>    <div class="pad24">        <div class="field">            <label>Type</label>            <div class="field_entry">                <input type="radio" name="member_type" value="member" checked="checked"/> Existing Member.<br/>                <input type="radio" name="member_type" value="new_user"/> New non-member user.<br/>            </div>        </div>        <div id="existing_member">            <div class="field">                <label>Member</label>                <div class="field_entry">                    <input type="text" value="<?php echo $username; ?>" name="username_dud" id="usernamed"                           autocomplete="off" onkeyup="return autocom(this.id,'id','username','ppSD_members','username','members');"                           style="width:250px;"/> <a href="null.php" onclick="return get_list('member','usernamed_id','usernamed');"><img src="imgs/icon-list.png" width="16" height="16" border="0" alt="Select from list" title="Select from list" class="icon-right"/></a>                    <input type="hidden" name="sub[member_id]" id="usernamed_id" value="<?php echo $user_id; ?>"/>                </div>            </div>        </div>        <div id="new_contact" style="display:none;">            <div class="field">                <label>First Name</label>                <div class="field_entry">                    <input type="text" name="user[first_name]" style="width:250px;"/>                </div>            </div>            <div class="field">                <label>Last Name</label>                <div class="field_entry">                    <input type="text" name="user[last_name]" style="width:250px;"/>                </div>            </div>            <div class="field">                <label>E-Mail</label>                <div class="field_entry">                    <input type="text" name="user[email]" style="width:250px;"/>                </div>            </div>        </div>    </div></fieldset><fieldset><legend>Credit Card</legend><div class="pad24">    <p class="highlight">The user will NOT be charged right away. Instead, the program will naturally charge the user when the automated cron job runs on the "next renewal" date specified above.</p><div class="field">    <label>Type</label>    <div class="field_entry">        <input type="radio" name="card_type" value="none" checked="checked"/> Do not associated a card.<br/>        <input type="radio" name="card_type" value="existing_card"/> Use a credit card on file.<br/>        <input type="radio" name="card_type" value="new_card"/> Add a new card.<br/>    </div></div><div id="no_card" style="display:block;">    <p>User will be invoiced when this subscription is due.</p></div><ul id="existing_card" style="display:none;"></ul><div id="new_card" style="display:none;">    <div class="field">        <label>Number</label>        <div class="field_entry">            <input type="text" name="cc[cc_number]" style="width:250px;" maxlength="16"/>        </div>    </div>    <div class="field">        <label>Expires (MM/YY)</label>        <div class="field_entry">            <input type="text" name="cc[card_exp_mm]" style="width:80px;" class="zen_num" maxlength="2"/> / <input                type="text" name="cc[card_exp_yy]" style="width:80px;" class="zen_num" maxlength="2"/>        </div>    </div>    <div class="field">        <label>CVV</label>        <div class="field_entry">            <input type="text" name="cc[cvv]" style="width:100px;" maxlength="4"/>        </div>    </div>    <div class="field">        <label>First Name</label>        <div class="field_entry">            <input type="text" name="cc[first_name]" style="width:250px;"/>        </div>    </div>    <div class="field">        <label>Last Name</label>        <div class="field_entry">            <input type="text" name="cc[last_name]" style="width:250px;"/>        </div>    </div>    <div class="field">        <label>Address Line 1</label>        <div class="field_entry">            <input type="text" name="cc[address_line_1]" style="width:310px;"/>        </div>    </div>    <div class="field">        <label>Address Line 2</label>        <div class="field_entry">            <input type="text" name="cc[address_line_2]" style="width:310px;"/>        </div>    </div>    <div class="field">        <label>City</label>        <div class="field_entry">            <input type="text" name="cc[city]" style="width:250px;"/>        </div>    </div>    <div class="field">        <label>State</label>        <div class="field_entry">            <select name="cc[state]" style="width:250px;">                <?php                $fields = new field;                echo $fields->state_list('', '1', 'select');                ?>            </select>        </div>    </div>    <div class="field">        <label>Zip</label>        <div class="field_entry">            <input type="text" name="cc[zip]" style="width:100px;" maxlength="6"/>        </div>    </div>    <div class="field">        <label>County</label>        <div class="field_entry">            <select name="cc[country]" style="width:250px;">                <?php                $fields = new field;                echo $fields->country_list('', '1', 'select');                ?>            </select>        </div>    </div></div></div></fieldset><script type="text/javascript">    $("input[name=card_type]").live("change", function () {        var val = $('input[name=card_type]:checked', '#popupform').val();        if (val == 'existing_card') {            show_loading();            if (!$('#usernamed_id').val()) {                alert('Select a member first.');                close_loading();                return false;            } else {                send_data = 'id=' + $('#usernamed_id').val();                $.post('cp-functions/find_credit_card.php', send_data, function (theResponse) {                    $('#existing_card').html(theResponse);                    $('#new_card').hide();                    $('#existing_card').show();                    $('#no_card').hide();                    close_loading();                });                return false;            }        }        else if (val == 'new_card') {            $('#new_card').show();            $('#existing_card').hide();            $('#no_card').hide();        }        else {            $('#new_card').hide();            $('#existing_card').hide();            $('#no_card').show();        }    });    $("input[name=member_type]").live("change", function () {        var val = $('input[name=member_type]:checked', '#popupform').val();        if (val == 'member') {            $('#new_contact').hide();            $('#existing_member').show();        } else {            $('#existing_member').hide();            $('#new_contact').show();        }    });</script></div></form>